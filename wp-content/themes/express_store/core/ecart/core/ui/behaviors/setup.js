/*
 * setup.js - General settings screen behaviors
 */
jQuery(document).ready(function(){var f=jqnc(),c=f("#activation-button"),h=f("#activation-status"),a=f("#base_operations"),b=f("#base_operations_zone");function e(i,o,m){var k=c.attr("disabled",false).removeClass("updating"),n=f("#update-key"),l=(i instanceof Array)?i[0]:false,j=(i instanceof Array)?i[1]:false;type=(i instanceof Array)?i[2]:false;if(l===false){k.attr("disabled",true);return h.html(keyStatus["-000"]).addClass("activating").show()}if(k.hasClass("deactivation")){k.html(ECART_DEACTIVATE_KEY)}else{k.html(ECART_DEACTIVATE_KEY)}if(l=="1"){if(type=="dev"&&n.attr("type")=="text"){n.replaceWith('<input type="password" name="updatekey" id="update-key" value="'+n.val()+'" readonly="readonly" size="40" />')}else{n.attr("readonly",true)}k.html(ECART_DEACTIVATE_KEY).addClass("deactivation")}else{if(n.attr("type")=="password"){n.replaceWith('<input type="text" name="updatekey" id="update-key" value="" size="40" />')}n.attr("readonly",false);k.html(ECART_ACTIVATE_KEY).removeClass("deactivation")}if(l!==false){h.html(keyStatus[l]);if(l!=0&&l!=1){h.addClass("activating").show()}else{h.removeClass("activating").show()}}else{h.addClass("activating").show()}}if(activated){e([1],"success")}else{h.show()}c.click(function(){f(this).html(ECART_CONNECTING+"&hellip;").attr("disabled",true).addClass("updating");if(f(this).hasClass("deactivation")){f.getJSON(deact_key_url+"&action=ecart_deactivate_key",e)}else{f.getJSON(act_key_url+"&action=ecart_activate_key&key="+f("#update-key").val(),e)}}).html(activated?ECART_DEACTIVATE_KEY:ECART_ACTIVATE_KEY);if(!a.val()||a.val()==""){b.hide()}if(!b.val()){b.hide()}a.change(function(){if(a.val()==""){b.hide();return true}f.getJSON(zones_url+"&action=ecart_country_zones&country="+a.val(),function(i){b.hide();b.empty();if(!i){return true}f.each(i,function(k,j){option=f("<option></option>").val(k).html(j).appendTo("#base_operations_zone")});b.show()})});f("#selectall_targetmarkets").change(function(){if(f(this).attr("checked")){f("#target_markets input").not(this).attr("checked",true)}else{f("#target_markets input").not(this).attr("checked",false)}});function d(k,o,r){if(isNaN(k)){return}var l=labelInputs.length+1,k=!k?l:k,q='<li id="item-'+l+'"><span><input type="text" name="settings[order_status]['+k+']" id="label-'+l+'" size="14" /><button type="button" class="delete"><img src="'+ECART_PLUGINURI+'/core/ui/icons/delete.png" alt="Delete" width="16" height="16" /></button><button type="button" class="add"><img src="'+ECART_PLUGINURI+'/core/ui/icons/add.png" alt="Add" width="16" height="16" /></button></span></li>',s=!r?f(q).appendTo("#order-statuslabels"):f(q).insertAfter(r),p=s.find("input").val(o?o:""),m=s.find("button.delete").hide().click(function(){if(confirm(ECART_CONFIRM_DELETE_LABEL)){s.remove()}}),n=s.find("button.add").click(function(){d(null,null,"#"+s.attr("id"))}),j=s.find("span").hover(function(){if(l>0){m.show()}},function(){m.hide()});labelInputs.push(s)}if(labels){for(var g in labels){d(g,labels[g])}}else{d()}});