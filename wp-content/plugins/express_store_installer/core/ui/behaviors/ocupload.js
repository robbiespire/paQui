/*
 * One Click Upload - jQuery Plugin
 */
(function(a){a.fn.upload=function(b){b=a.extend({name:"file",enctype:"multipart/form-data",action:"",autoSubmit:true,onSubmit:function(){},onComplete:function(){},onSelect:function(){},params:{}},b);return new a.ocupload(this,b)};a.ocupload=function(f,e){var d=this,i=new Date().getTime().toString().substr(8),g=a('<iframe id="iframe'+i+'" name="iframe'+i+'"></iframe>').css({display:"none"}),h=a('<form method="post" enctype="'+e.enctype+'" action="'+e.action+'" target="iframe'+i+'"></form>').css({margin:0,padding:0}).submit(function(j){if(j){j.stopPropagation()}}),c=a('<input name="'+e.name+'" type="file" />').css({position:"relative",display:"block",marginLeft:-175+"px",opacity:0}),b=false;f.wrap("<div></div>");h.append(c);f.after(h);f.after(g);elementHeight=f.outerHeight();elementWidth=f.outerWidth();b=f.parent().css({position:"relative",height:(elementHeight+10)+"px",width:(elementWidth+10)+"px",overflow:"hidden",cursor:"pointer",margin:0,padding:0});c.css("marginTop",-b.height()-10+"px");b.mousemove(function(j){c.css({top:j.pageY-b.offset().top+"px",left:j.pageX-b.offset().left+"px"})});c.change(function(){if(this.value==""){return false}if(a.browser.msie){if(this.firedChange){return this.firedChange=false}this.firedChange=true}d.onSelect();if(d.autoSubmit){d.submit()}});a.extend(this,{autoSubmit:true,onSubmit:e.onSubmit,onComplete:e.onComplete,onSelect:e.onSelect,filename:function(){return c.attr("value")},params:function(j){var j=j?j:false;if(j){e.params=a.extend(e.params,j)}else{return e.params}},name:function(j){var j=j?j:false;if(j){c.attr("name",value)}else{return c.attr("name")}},action:function(j){var j=j?j:false;if(j){h.attr("action",j)}else{return h.attr("action")}},enctype:function(j){var j=j?j:false;if(j){h.attr("enctype",j)}else{return h.attr("enctype")}},set:function(l,k){var k=k?k:false;function j(n,m){switch(n){default:throw new Error("[jQuery.ocupload.set] '"+n+"' is an invalid option.");break;case"name":d.name(m);break;case"action":d.action(m);break;case"enctype":d.enctype(m);break;case"params":d.params(m);break;case"autoSubmit":d.autoSubmit=m;break;case"onSubmit":d.onSubmit=m;break;case"onComplete":d.onComplete=m;break;case"onSelect":d.onSelect=m;break}}if(k){j(l,k)}else{a.each(l,function(m,n){j(m,n)})}},submit:function(){this.onSubmit();var m=h.attr("action").split("?"),l=m[0],k=m[1]?m[1].split("&"):[],j={},n=false;a.each(k,function(o,q){var p=q.split("=");if(p.length==2&&!e.params[p[0]]){j[p[0]]=p[1]}});n=l+"?"+(a(j).size()>0?a.param(j)+"&":"")+a.param(e.params);h[0].setAttribute("action",n);h.submit();g.unbind().load(function(){var p=document.getElementById(g.attr("name"));var o=a(p.contentWindow.document.body).text();d.onComplete(o)})}})}})(jQuery);